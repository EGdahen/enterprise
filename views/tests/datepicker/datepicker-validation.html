<div class="row">
	<div class="twelve columns">
		<h2>Time Example</h2>
		<p>Shows an example of a date picker with custom validation.</p>
		<br>

		<div class="field">
			<label for="log-startTime-modal" >Start Time</label>
			<input
				id="log-startTime-modal"
				name="log-startTime-modal"
				type="text"
				class="datepicker datetime"
				data-validate="required valid-logging-time"
				data-validation-events="{'required': 'change blur', 'valid-logging-time': 'change blur'}"
				data-options="{'showTime': 'true', 'minuteInterval': '10', 'roundToInterval': 'false', 'timeFormat': 'HH:mm'}" />
		</div>
		<div class="field">
			<label for="log-endTime-modal" >End Time</label>
			<input
				id="log-endTime-modal"
				name="log-endTime-modal"
				type="text"
				class="datepicker datetime"
				data-validate="required valid-logging-time"
				data-validation-events="{'required': 'change blur', 'valid-logging-time': 'change blur'}"
				data-options="{'showTime': 'true', 'minuteInterval': '10', 'roundToInterval': 'false', 'timeFormat': 'HH:mm'}" />
		</div>

	</div>
</div>
</div>

<script>

function dateValue(selector) {
  var obj = $(selector);
  var val = obj.val();
  if (val) {
    return new Date(val);
  }
  return null;
}

function validLoggingTimeModalCheck(value) {
  var startTime = dateValue('#log-startTime-modal'),
      endTime = dateValue('#log-endTime-modal');
    if ((startTime instanceof Date) && (endTime instanceof Date)) {
      var elapsed = endTime.getTime() - startTime.getTime();
      if (elapsed <= 0) {
        return false;
      }
      if (elapsed > 24*60*60*1000) {
        return false;
      }
    }

		// If return true make sure if any error on other element clear too
		if (startTime && endTime) {
			var elm = $(((new Date(value)).getTime() === startTime.getTime()) ?
				'#log-endTime-modal' : '#log-startTime-modal');

			if(elm.is('.error')) {
				elm.trigger('blur');
			}
		}
    return true;
  }

  $.fn.validation.rules['valid-logging-time'] = {
    check: validLoggingTimeModalCheck,
    message: 'The start time must be before the end time, and the end time must be no more than 24 hours after the start time.',
    async: false
  };
</script>
