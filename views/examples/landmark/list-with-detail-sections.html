<body class="no-scroll">
  <a href="#maincontent" class="skip-link" data-translate="text">SkipToMain</a>
  {{> includes/svg-inline-refs}}
  {{> includes/applicationmenu}}

  <div class="page-container no-scroll">
    <header class="header is-sticky">
      <div class="toolbar">
        <div class="title">
          <button class="btn-icon application-menu-trigger" type="button">
            <span class="audible">Application Menu</span>
            <span class="icon app-header">
                <span class="one"></span>
                <span class="two"></span>
                <span class="three"></span>
              </span>
          </button>

          <h1>Landmark List With Detail Sections</h1>
        </div>

        <div class="buttonset">
        </div>

      </div>
    </header>

    <div id="maincontent" class="page-container scrollable" role="main">
      <div class="page-container">

        <section class="pane top no-scroll">
          <div class="toolbar" role="toolbar">
            <div class="title">My Assets</div>
            <div class="buttonset">
              <button id="activate-selected-row" type="button" class="btn">
                <span>Activate Selected Row</span>
              </button>
              <button id="deactivate-activated-row" type="button" class="btn">
                <span>Deactivate Activated Row</span>
              </button>
            </div>
            <div class="more">
              <button class="btn-actions" type="button">
                <svg class="icon" focusable="false" aria-hidden="true" role="presentation">
                  <use xlink:href="#icon-more"></use>
                </svg>
                <span class="audible">More Actions</span>
              </button>
              <ul class="popupmenu">
                <li><a href="#">Option One</a></li>
                <li><a href="#">Option Two</a></li>
                <li><a href="#">Option Three</a></li>
                <li class="separator single-selectable-section"></li>
                <li class="heading">Row Height</li>
                <li class="is-selectable"><a data-option="row-short" href="#">Short</a></li>
                <li class="is-selectable"><a data-option="row-medium" href="#">Medium</a></li>
                <li class="is-selectable is-checked"><a data-option="row-normal" href="#">Normal</a></li>
              </ul>
            </div>
          </div>

          <div class="contextual-toolbar toolbar is-hidden">
            <div class="title selection-count">0 Selected</div>
            <div class="buttonset">
              <button class="btn" type="button">
                <svg class="icon" focusable="false" aria-hidden="true" role="presentation">
                  <use xlink:href="#icon-link"></use>
                </svg>
                <span>Example</span>
              </button>
            </div>
          </div>
          <div id="datagrid-header"></div>
        </section>

        <section class="pane bottom no-scroll">
          <div id="tabs-normal" class="tab-container">
            <ul class="tab-list">
              <li class="tab"><a href="#tab1">Details</a></li>
              <li class="tab"><a href="#tab2">Opportunites</a></li>
              <li class="tab"><a href="#tab3">Attachments</a></li>
            </ul>
            <div id='tab1'>
              <div class="page-container">
                <div id="datagrid-detail"></div>
              </div>
              <div id='tab2'><p>Tab2</p></div>
              <div id='tab3'><p>Tab3</p></div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>

  <script>
    $('body').one('initialized', function () {

      var columnsHeader = [], columnsDetail = [];

      // Header Grid Columns
      columnsHeader.push({ id: 'selectionCheckbox', sortable: false, resizable: false, formatter: Formatters.SelectionCheckbox, align: 'center'});
      columnsHeader.push({ id: 'id', name: 'Number', field: 'id', width: 80});
      columnsHeader.push({ id: 'type', name: 'Type', field: 'type', formatter: Formatters.Hyperlink});
      columnsHeader.push({ id: 'description', name: 'Description', field: 'description'});
      columnsHeader.push({ id: 'manufacturer', name: 'Manufacturer', field: 'manufacturer'});
      columnsHeader.push({ id: 'serial', name: 'Serial', field: 'serial'});
      columnsHeader.push({ id: 'status', name: 'Status', field: 'status'});

      // Detail Grid Columns
      columnsDetail.push({ id: 'action', name: 'Asset History', field: 'action'});
      columnsDetail.push({ id: 'ticket', name: 'Ticket', field: 'ticket', formatter: Formatters.Hyperlink});
      columnsDetail.push({ id: 'date', name: 'Date', field: 'date'});
      columnsDetail.push({ id: 'description', name: 'Description', field: 'description'});
      columnsDetail.push({ id: 'technician', name: 'Technician', field: 'technician'});
      columnsDetail.push({ id: 'assignee', name: 'Assignee', field: 'assignee'});
      columnsDetail.push({ id: 'status', name: 'Status', field: 'status'});

      var url = '{{basepath}}api/assets',
        selectedId = 0;

      $.getJSON(url, function(res) {

        var syncDetail = function(idx) {
          detailGrid.settings.resultsText = res[idx].id;
          detailGrid.loadData(res[idx].detail);
        }

        //Init The Header Grid
        var headerGrid = $('#datagrid-header').datagrid({
          dataset: res,
          columns: columnsHeader,
          editable: false,
          selectable: 'mixed',
          paging: true,
          pagesize: 10,
        }).on('rowactivated', function (e, args) {
          console.log('Row ' + args.row + ' Was Activated');
          syncDetail(args.row);
        }).on('rowdeactivated', function (e, args) {
          console.log('Row ' + args.row + ' Was Deactivated');
          syncDetail(args.row);
        }).on('selected', function (e, args) {
          console.log(args);
        }).data('datagrid');

        $('#activate-selected-row').on('click', function(e) {
          if (!headerGrid.selectedRows()[0]) {
            return;
          }

          headerGrid.activateRow(headerGrid.selectedRows()[0].idx);
        });

        $('#deactivate-activated-row').on('click', function(e) {
          console.log('activated row to be deactivated is ' + headerGrid.activatedRow());
          headerGrid.deactivateRow();
        });

        //Init The Detail Grid
        var detailGrid = $('#datagrid-detail').datagrid({
          dataset: res[selectedId].detail,
          columns: columnsDetail,
          editable: false,
          resultsText: res[selectedId].id,
          toolbar: {results: true, actions: true, rowHeight: true, title: 'Detail for '}
        }).data('datagrid');
      });

    });

  </script>
</body>
