<body class="no-scroll">

  <a href="#maincontent" class="skip-link" data-translate="text">SkipToMain</a>
  {{> controls/svg}}

  <!-- Masthead -->
  {{> includes/masthead}}

  <!-- Module Tabs -->
  <section id="module-tabs-example" class="tab-container module-tabs" data-options="{ containerElement: '#module-tabs-container' }">
    <div class="tab-list-container">
      <ul class="tab-list">
        <li class="tab"><a href="#module-tabs-controls">New Tab Builder</a></li>
        <li class="tab is-selected dismissible"><a href="#order-entry">Order Entry</a></li>
        <li class="tab dismissible"><a href="#order-123456">Order 123456</a></li>
      </ul>
    </div>
  </section>

  {{> includes/applicationmenu}}

  <!-- Page Container -->
  <div id="module-tabs-container" class="page-container no-scroll">

    <!-- Tab Panels -->
    <div id="module-tabs-controls" class="tab-panel no-scroll" style="display: none;">
      <header class="header is-personalizable">
        <div class="toolbar">
          <div class="title">
            <h1>Module Tabs Controls</h1>
          </div>
          <div class="buttonset"></div>
        </div>
      </header>
      <div class="page-container scrollable">

        <div class="row">
          <div class="twelve columns">

            <form id="add-tab" action="#" method="post">
              <div class="row">
                <div class="six columns">
                  <div class="field">
                    <label for="create-tab-name">Tab Name:</label>
                    <input id="create-tab-name" name="create-tab-name" />
                  </div>

                  <div class="field">
                    <label for="create-tab-content">Content:</label>
                    <textarea id="create-tab-content" name="create-tab-content"></textarea>
                  </div>

                  <div class="field">
                    <button id="reset" class="btn-tertiary" type="reset"><span>Clear</span></button>
                    <button id="submit" class="btn-primary" type="submit"><span>Create New Tab</span></button>
                  </div>
                </div>
                <div class="six columns"></div>
              </div>
            </form>

          </div>
        </div>

      </div>
    </div>

    <div id="order-entry" class="tab-panel no-scroll">
      <header class="header is-personalizable">
        <div class="toolbar">
          <div class="title">
            <h1>
              <span class="head">Order Entry</span><br>
              <span class="subheader" style="font-size: smaller;">Advanced Line Entry</span>
            </h1>
          </div>
          <div class="buttonset"></div>
        </div>
      </header>
      <div class="page-container scrollable">

        <div class="expandable-area is-expanded">
          <div class="expandable-header">
            <a class="title"><span>Basic</span></a>
          </div>
          <div class="expandable-pane">
            <div class="content">
              TODO: Write Content
            </div>
          </div>
        </div>

        <div class="expandable-area is-expanded">
          <div class="expandable-header">
            <a class="title"><span>Extended</span></a>
          </div>
          <div class="expandable-pane">
            <div class="content">
              TODO: Write Content
            </div>
          </div>
        </div>

      </div>
    </div>

    <div id="order-123456" class="tab-panel" style="display: none;">
      <header class="header is-personalizable">
        <div class="toolbar">
          <div class="title">
            <h1>Order #123456</h1>
          </div>
          <div class="buttonset"></div>
        </div>
      </header>
      <div class="page-container scrollable">
        <div class="row">
          <div class="six columns">
            <p>This is Order #123456</p>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script type="text/javascript">
    function makeId(name) {
      var stringName = name.toLowerCase().split(' ').join('-');

      var existing = $('[id^="'+ stringName +'"]');
      if (!existing.length) {
        return stringName + '-0';
      }

      return stringName + '-' + existing.length;
    }

    function wrapInPageMarkup(name, content) {
      return '<header class="header is-personalizable">' +
        '<div class="toolbar">' +
          '<div class="title">' +
            '<h1>' + name + '</h1>' +
          '</div>' +
          '<div class="buttonset"></div>' +
        '</div>' +
      '</header>' +
      '<div class="page-container scrollable"><div class="row"><div class="twelve columns">' + content + '</div></div></div>';
    }

    $('body').on('initialized', function() {
      var tabsAPI = $('#module-tabs-example').data('tabs');

      $('#add-tab').on('submit', function(e) {
        e.preventDefault();

        var name = '' + $('#create-tab-name').val(),
          content = '' + $('#create-tab-content').val();

        // Wrap the content in a page-wrapper and header
        content = wrapInPageMarkup(name, content);

        var id = makeId(name);
        tabsAPI.add(id, {
          name: name,
          content: content,
          isDismissible: true
        });

        console.log('new ID: ' + id);
      });
    });
  </script>

</body>
